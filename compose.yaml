services:
  app:
    image: partymonster:dev
    depends_on:
      db:
        condition: service_healthy
    env_file:
      - .env
    environment:
      SPRING_DATASOURCE_URL: ${SPRING_DATASOURCE_URL:-jdbc:postgresql://db:5432/partyapp}
      SPRING_DATASOURCE_DRIVER: ${SPRING_DATASOURCE_DRIVER:-org.postgresql.Driver}
      SPRING_DATASOURCE_USERNAME: ${SPRING_DATASOURCE_USERNAME:-app_user}
      SPRING_DATASOURCE_PASSWORD: ${SPRING_DATASOURCE_PASSWORD:-change_me}
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-local}
      SPRING_MAIL_HOST: ${SPRING_MAIL_HOST:-localhost}
      SPRING_MAIL_PORT: ${SPRING_MAIL_PORT:-1025}
      SPRING_MAIL_USERNAME: ${SPRING_MAIL_USERNAME:-}
      SPRING_MAIL_PASSWORD: ${SPRING_MAIL_PASSWORD:-}
      SPRING_MAIL_SMTP_AUTH: ${SPRING_MAIL_SMTP_AUTH:-false}
      SPRING_MAIL_SMTP_STARTTLS: ${SPRING_MAIL_SMTP_STARTTLS:-false}
      SPRING_MAIL_SSL_ENABLED: ${SPRING_MAIL_SSL_ENABLED:-false}
      APP_MAIL_FROM: ${APP_MAIL_FROM:-noreply@partymonster.com}
    ports:
      - "8080:8080"
  grafana-lgtm:
    image: 'grafana/otel-lgtm:latest'
    ports:
      - '3000'
      - '4317'
      - '4318'
  postgres:
    image: 'postgres:latest'
    env_file:
      - .env
    environment:
      POSTGRES_DB: ${POSTGRES_DB:-partyapp}
      POSTGRES_USER: ${POSTGRES_USER:-app_user}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-change_me}
    ports:
      - '5432'
  redis:
    image: 'redis:latest'
    ports:
      - '6379'
